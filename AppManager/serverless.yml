service: api-app-manager

# Add the serverless-webpack plugin
plugins:
  - serverless-webpack
  - serverless-offline
  - serverless-domain-manager
  - serverless-api-compression
  - serverless-add-api-key

custom:
  webpack:
    includeModules:
      forceExclude:
        - node_modules/aws-sdk
  role:
    dev: arn:aws:iam::997357843271:role/Lambda
    prod: arn:aws:iam::912918454053:role/Lambda
  deploymentBucket:
    dev: digicore-lambda-deployment-dev
    prod: digicore-lambda-deployment
  profile:
    dev: DigiDev
    prod: DigiProd
  domain:
    domainName:
      dev: 'dev-api.digicore.io'
      prod: 'api.digicoretemp.de' 
  customDomain:  
      domainName: ${self:custom.domain.domainName.${self:provider.stage}} 
      basePath: 'app-api'
      stage: ${self:provider.stage}
      createRoute53Record: true
      certificateName: '*.api.digicoretemp.de'
      endpointType: 'edge'
  apiKeys:
    - name: digicore-api-key

provider:
  name: aws
  runtime: nodejs10.x
  stage: ${opt:stage,'dev'}
  profile: ${self:custom.profile.${self:provider.stage}} 
  region: us-east-1
  stackName: app-api
  role: ${self:custom.role.${self:provider.stage}}
  deploymentBucket:
    name: ${self:custom.deploymentBucket.${self:provider.stage}}
    serverSideEncryption: AES256
  apiName: api.app-manager
  environment:
    SERVICE_NAME: ${self:service}


#TODO Add config for swagger gen
functions:
  service:
    handler: handler.handle
    name: EventBus-AppManager-${self:provider.stage}
    events:
      - http:
          path: applications/{applicationId}/companies/{companyId}/entities/{entityId}
          method: get
          cors: true
          private: true  
      - http:
          method: put
          path: applications/{applicationId}/companies/{companyId}/entities/{entityId}
          cors: true
          private: true
      - http:
          method: put
          path: applications/{applicationId}/companies/{companyId}
          cors: true
          private: true
      - http:
          path: companies/{companyId}/applications
          method: get
          cors: true
          private: true

